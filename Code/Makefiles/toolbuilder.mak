# - -------------------------------------------------------------------------------------------- - #
include config.mak
-include $(SEARCH_DIR)/local.mak
include Code/Makefiles/tools.mak
include Code/Makefiles/$(HOST_PLATFORM)/platform.mak
# - -------------------------------------------------------------------------------------------- - #
INCLUDE_DIRS	:=	$(addprefix -I ,$(INCLUDE_DIRS))
LIB_DIRS		:=	$(addprefix -L ,$(LIB_DIRS))
DEFINES			:=	$(addprefix -D,$(DEFINES))
CODE_FLAGS		:=	$(CODE_FLAGS) $(DEFINES)

CODE_DIRS		:=	$(addprefix Code/,$(CODE_DIRS))
CODE_FILES		:=	$(addprefix Code/,$(CODE_FILES))
CODE_FILES		:=	$(CODE_FILES) $(foreach VAR,$(CODE_DIRS),$(shell $(TreeTool) $(VAR) .cpp .c) )
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
FILES			:=	$(shell $(TreeTool) $(SEARCH_DIR) .cpp .c)
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
OUT_DIR			:=	$(subst Code/,Output/,$(SEARCH_DIR))
# - -------------------------------------------------------------------------------------------- - #
MY_O_FILES		:=	$(addsuffix .o,$(subst Code/,Output/,$(FILES)))
OTHER_O_FILES	:=	$(addprefix $(OUT_DIR)/,$(addsuffix .o,$(CODE_FILES)))

.O_FILES		:=	$(MY_O_FILES) $(OTHER_O_FILES)
# - -------------------------------------------------------------------------------------------- - #


# - -------------------------------------------------------------------------------------------- - #
$(OUT_DIR)/$(BINARY_TARGET): makedirs $(.O_FILES)
	g++ $(LIB_DIRS) -s $(LINK_FLAGS) $(.O_FILES) $(LIBS) -o $(OUT_DIR)/$(BINARY_TARGET)
# - -------------------------------------------------------------------------------------------- - #
makedirs:
	$(MakeDir) $(sort $(dir $(.O_FILES)))
# - -------------------------------------------------------------------------------------------- - #


# - -------------------------------------------------------------------------------------------- - #
# - Compiling Local Files ---------------------------------------------------------------------- - #
$(OUT_DIR)/%.cpp.o: $(SEARCH_DIR)/%.cpp
	g++ $(INCLUDE_DIRS) $(CODE_FLAGS) -MMD -MF $@.d -c $< -o $@ 
# - -------------------------------------------------------------------------------------------- - #
$(OUT_DIR)/%.c.o: $(SEARCH_DIR)/%.c
	gcc $(INCLUDE_DIRS) $(CODE_FLAGS) -MMD -MF $@.d -c $< -o $@ 
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
# - Compiling External Files ------------------------------------------------------------------- - #
$(OUT_DIR)/%.cpp.o: %.cpp
	g++ $(INCLUDE_DIRS) $(CODE_FLAGS) -MMD -MF $@.d -c $< -o $@ 
# - -------------------------------------------------------------------------------------------- - #
$(OUT_DIR)/%.c.o: %.c
	gcc $(INCLUDE_DIRS) $(CODE_FLAGS) -MMD -MF $@.d -c $< -o $@ 
# - -------------------------------------------------------------------------------------------- - #


# - -------------------------------------------------------------------------------------------- - #
-include $(.O_FILES:.o=.o.d)
# - -------------------------------------------------------------------------------------------- - #
