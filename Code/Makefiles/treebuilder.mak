# - -------------------------------------------------------------------------------------------- - #
include config.mak
include Code/Makefiles/tools.mak
include Code/Makefiles/Gl/platform.mak
# - -------------------------------------------------------------------------------------------- - #
INCLUDE_DIRS	:=	$(addprefix -I ,$(INCLUDE_DIRS))
LIB_DIRS		:=	$(addprefix -L ,$(LIB_DIRS))
DEFINES			:=	$(addprefix -D,$(DEFINES))
CODE_FLAGS		:=	$(CODE_FLAGS) $(DEFINES)
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
DIRS			:=	$(filter-out %.mak,$(shell $(TreeTool) $(SEARCH_DIR) .))
FILES			:=	$(shell $(TreeTool) $(SEARCH_DIR) .cpp .c)
# - -------------------------------------------------------------------------------------------- - #
TARGETS			:=	$(addprefix Output/,$(addsuffix .exe,$(join $(subst Code/,,$(DIRS)),$(addprefix /,$(notdir $(DIRS))))))
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
OUT_DIR			:=	Output/$(PLATFORM)
OBJ_DIR			:=	$(OUT_DIR)/obj
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
CODE_DIRS		:=	External Library
# - -------------------------------------------------------------------------------------------- - #
CODE_DIRS		:=	$(addprefix Code/,$(CODE_DIRS))
# - -------------------------------------------------------------------------------------------- - #


# - -------------------------------------------------------------------------------------------- - #
#.CPP_FILES		:=	$(foreach VAR,$(CODE_DIRS),$(shell $(TreeTool) $(VAR) .cpp .c) )
# - -------------------------------------------------------------------------------------------- - #
#.O_FILES		:=	$(addsuffix .o,$(addprefix $(OBJ_DIR)/,$(.CPP_FILES)))
# - -------------------------------------------------------------------------------------------- - #


# - -------------------------------------------------------------------------------------------- - #
default: makedirs $(TARGETS)
	@echo ---- Tools Built ---------------------------------------------------
# - -------------------------------------------------------------------------------------------- - #
makedirs:
	@echo ---- Building Tools... ---------------------------------------------
	$(MakeDir) $(sort $(dir $(TARGETS)))
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
Output/%.exe: makedirs $(.O_FILES)
	$(MAKE)	PLATFORM=$(PLATFORM) \
		SEARCH_DIR=$(subst /_KEIFER_,,$(addsuffix _KEIFER_,$(addprefix Code/,$(dir $*)))) \
		GAME_TARGET=$(notdir $*) \
		-S -f Code/Makefiles/toolbuilder.mak
# - -------------------------------------------------------------------------------------------- - #
clean: 
	$(Remove) $(OUT_DIR)
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
# - Compiling ---------------------------------------------------------------------------------- - #
# - -------------------------------------------------------------------------------------------- - #
$(OBJ_DIR)/%.cpp.o: %.cpp
	g++ $(INCLUDE_DIRS) $(CODE_FLAGS) -MMD -MF $@.d -c $< -o $@ 
# - -------------------------------------------------------------------------------------------- - #
$(OBJ_DIR)/%.c.o: %.c
	gcc $(INCLUDE_DIRS) $(CODE_FLAGS) -MMD -MF $@.d -c $< -o $@ 
# - -------------------------------------------------------------------------------------------- - #

# - -------------------------------------------------------------------------------------------- - #
-include $(.O_FILES:.o=.o.d)
# - -------------------------------------------------------------------------------------------- - #
